# 파일 업로드 문제 해결 가이드

## ✅ 수정된 사항

### 1. Firebase Storage 초기화 강화
- **재시도 로직 추가**: 최대 3회까지 자동 재시도
- **Storage 인스턴스 안정적 가져오기**: 여러 방법으로 시도
- **초기화 확인 개선**: Storage도 초기화되었는지 확인

### 2. 업로드 에러 핸들링 개선
- **상세한 에러 메시지**: 사용자에게 명확한 안내 제공
- **인증 토큰 강제 갱신**: `getIdToken(true)` 사용
- **네트워크 오류 감지**: 네트워크 문제 시 별도 메시지

### 3. 업로드 진행률 표시
- **진행률 단계 표시**: 10% → 80% → 100%
- **로그 개선**: 더 상세한 디버깅 정보

## 🔧 주요 변경 파일

### `components/WriteModal.tsx`
- Storage 초기화 재시도 로직 추가
- 인증 토큰 강제 갱신
- 상세한 에러 메시지

### `lib/firebase.ts`
- Storage 초기화 확인 개선
- Storage 인스턴스 생성 실패 시 재시도

## 🐛 문제 해결 체크리스트

업로드가 안 될 때 확인 사항:

1. **로그인 상태 확인**
   - 로그인되어 있는지 확인
   - 인증 토큰이 유효한지 확인

2. **Firebase Storage 설정 확인**
   - Firebase Console에서 Storage 활성화 확인
   - Storage 보안 규칙 확인 (인증된 사용자만 업로드 가능)

3. **브라우저 콘솔 확인**
   - 개발자 도구(F12) → Console 탭
   - 에러 메시지 확인

4. **네트워크 확인**
   - 인터넷 연결 상태 확인
   - CORS 오류 확인 (Network 탭)

## 🔍 디버깅 팁

### 콘솔 로그 확인
업로드 시도 시 다음 로그들이 표시됩니다:
- "파일 업로드 시작"
- "인증 토큰 확인 완료"
- "파일 업로드 완료, URL 생성 중..."
- "다운로드 URL 생성 완료"

### 일반적인 오류 코드
- `storage/unauthorized`: 권한 없음 (Storage 규칙 확인)
- `storage/quota-exceeded`: 저장 공간 부족
- `storage/unknown`: 알 수 없는 오류
- `auth/network-request-failed`: 네트워크 오류

## 🚀 다음 단계

업로드가 여전히 안 되면:
1. 브라우저 콘솔에서 정확한 에러 메시지 확인
2. Firebase Console에서 Storage 규칙 확인
3. 네트워크 탭에서 요청 상태 확인

