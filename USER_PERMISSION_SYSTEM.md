# ìœ ì € ê¶Œí•œ ì‹œìŠ¤í…œ ì„¤ê³„ì•ˆ

## ğŸ“‹ ê¶Œí•œ ë ˆë²¨ êµ¬ì¡°

### 1. ì‚¬ìš©ì ì—­í•  (User Roles)

```
ì¼ë°˜ ì‚¬ìš©ì (Guest/User)
  â†“
ì¸ì¦ëœ ìì˜ì—…ì (Verified Business Owner)
  â†“
ëª¨ë”ë ˆì´í„° (Moderator)
  â†“
ìŠˆí¼ ê´€ë¦¬ì (Super Admin)
```

## ğŸ­ ì—­í• ë³„ ê¶Œí•œ ìƒì„¸

### 1ï¸âƒ£ ì¼ë°˜ ì‚¬ìš©ì (User)
**ê¸°ë³¸ ê¶Œí•œ:**
- âœ… ê²Œì‹œê¸€ ì¡°íšŒ
- âœ… ëŒ“ê¸€ ì¡°íšŒ
- âœ… ê²Œì‹œê¸€ ì‘ì„± (ì œí•œì )
- âœ… ëŒ“ê¸€ ì‘ì„±
- âœ… ì¢‹ì•„ìš”/ë°˜ì‘
- âœ… ìª½ì§€ ë³´ë‚´ê¸°/ë°›ê¸°
- âŒ ì¸ì¦ ë°°ì§€ ì—†ìŒ
- âŒ íŠ¹ì • ì¹´í…Œê³ ë¦¬ ì œí•œ ê°€ëŠ¥

**ì œí•œ ì‚¬í•­:**
- ì¼ë¶€ í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ ì œí•œ
- ê´‘ê³  í‘œì‹œ
- ì¼ì¼ ê²Œì‹œê¸€ ì‘ì„± ì œí•œ (ì˜ˆ: 3ê°œ)

### 2ï¸âƒ£ ì¸ì¦ëœ ìì˜ì—…ì (Verified Business Owner)
**ì¶”ê°€ ê¶Œí•œ:**
- âœ… ì¸ì¦ ë°°ì§€ í‘œì‹œ
- âœ… ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì ‘ê·¼
- âœ… ì¼ì¼ ê²Œì‹œê¸€ ì œí•œ ì¦ê°€ (ì˜ˆ: 10ê°œ)
- âœ… ê´‘ê³  ì œê±°
- âœ… í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ ì‚¬ìš©
- âœ… ì‚¬ì—…ì ì •ë³´ í‘œì‹œ (ì„ íƒì )
- âœ… ì‹ ë¢°ë„ ì ìˆ˜ ì‹œìŠ¤í…œ ì°¸ì—¬

**ì¸ì¦ ì¡°ê±´:**
- ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ê²€ì¦ ì™„ë£Œ
- ì‚¬ì—…ìë“±ë¡ì¦ ì´ë¯¸ì§€ ê²€ì¦ ì™„ë£Œ
- ê´€ë¦¬ì ìŠ¹ì¸ (ì„ íƒì )

### 3ï¸âƒ£ ëª¨ë”ë ˆì´í„° (Moderator)
**ê´€ë¦¬ ê¶Œí•œ:**
- âœ… ê²Œì‹œê¸€ ì‚­ì œ/ìˆ¨ê¹€
- âœ… ëŒ“ê¸€ ì‚­ì œ/ìˆ¨ê¹€
- âœ… ì‹ ê³  ì²˜ë¦¬
- âœ… ì‚¬ìš©ì ê²½ê³ 
- âœ… ì¼ì‹œ ì •ì§€ (1-7ì¼)
- âŒ ì˜êµ¬ ì •ì§€ ë¶ˆê°€
- âŒ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬ ë¶ˆê°€
- âŒ ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ ë¶ˆê°€

**ì œí•œ:**
- ìì‹ ì˜ ì¡°ì¹˜ ë‚´ì—­ ê¸°ë¡
- ê´€ë¦¬ì ê°ë… í•˜ì— ìš´ì˜

### 4ï¸âƒ£ ìŠˆí¼ ê´€ë¦¬ì (Super Admin)
**ëª¨ë“  ê¶Œí•œ:**
- âœ… ëª¨ë“  ëª¨ë”ë ˆì´í„° ê¶Œí•œ
- âœ… ì‚¬ìš©ì ì˜êµ¬ ì •ì§€
- âœ… ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬/í•´ì œ
- âœ… ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ì ‘ê·¼
- âœ… í†µê³„ ë° ë¶„ì„
- âœ… ë°±ì—… ë° ë³µêµ¬

## ğŸ” ê¶Œí•œ ì²´í¬ ì‹œìŠ¤í…œ

### ê¶Œí•œ í™•ì¸ í•¨ìˆ˜ êµ¬ì¡°

```typescript
// lib/permissions.ts

export enum UserRole {
  USER = 'user',
  VERIFIED = 'verified',
  MODERATOR = 'moderator',
  SUPER_ADMIN = 'super_admin'
}

export enum Permission {
  // ê²Œì‹œê¸€
  POST_CREATE = 'post:create',
  POST_EDIT = 'post:edit',
  POST_DELETE = 'post:delete',
  POST_DELETE_ANY = 'post:delete:any',
  POST_HIDE = 'post:hide',
  
  // ëŒ“ê¸€
  COMMENT_CREATE = 'comment:create',
  COMMENT_DELETE = 'comment:delete',
  COMMENT_DELETE_ANY = 'comment:delete:any',
  
  // ì‚¬ìš©ì ê´€ë¦¬
  USER_BAN_TEMP = 'user:ban:temp',
  USER_BAN_PERM = 'user:ban:perm',
  USER_WARN = 'user:warn',
  USER_VIEW_DETAILS = 'user:view:details',
  
  // ì‹ ê³ 
  REPORT_VIEW = 'report:view',
  REPORT_HANDLE = 'report:handle',
  
  // ê´€ë¦¬
  ADMIN_MANAGE = 'admin:manage',
  SETTINGS_MANAGE = 'settings:manage',
  
  // í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥
  PREMIUM_FEATURES = 'premium:access',
  NO_ADS = 'ads:disable'
}

// ì—­í• ë³„ ê¶Œí•œ ë§¤í•‘
export const rolePermissions: Record<UserRole, Permission[]> = {
  [UserRole.USER]: [
    Permission.POST_CREATE,
    Permission.COMMENT_CREATE,
  ],
  [UserRole.VERIFIED]: [
    Permission.POST_CREATE,
    Permission.POST_EDIT,
    Permission.COMMENT_CREATE,
    Permission.PREMIUM_FEATURES,
    Permission.NO_ADS,
  ],
  [UserRole.MODERATOR]: [
    Permission.POST_DELETE_ANY,
    Permission.POST_HIDE,
    Permission.COMMENT_DELETE_ANY,
    Permission.USER_BAN_TEMP,
    Permission.USER_WARN,
    Permission.REPORT_VIEW,
    Permission.REPORT_HANDLE,
  ],
  [UserRole.SUPER_ADMIN]: [
    // ëª¨ë“  ê¶Œí•œ
    ...Object.values(Permission),
  ],
}

// ê¶Œí•œ í™•ì¸ í•¨ìˆ˜
export function hasPermission(
  userRole: UserRole,
  permission: Permission
): boolean {
  const permissions = rolePermissions[userRole] || []
  return permissions.includes(permission)
}

// ì‚¬ìš©ì ì •ë³´ íƒ€ì…
export interface UserPermissions {
  uid: string
  role: UserRole
  isVerified: boolean
  isBanned: boolean
  banUntil?: Date
  warnings: number
  permissions: Permission[]
  customPermissions?: Permission[] // ì»¤ìŠ¤í…€ ê¶Œí•œ (ê´€ë¦¬ìê°€ ê°œë³„ ë¶€ì—¬)
}
```

## ğŸ“Š Firebase ë°ì´í„° êµ¬ì¡°

### users/{userId} ìŠ¤í‚¤ë§ˆ

```typescript
{
  // ê¸°ë³¸ ì •ë³´
  uid: string
  email: string
  displayName: string
  anonymousName: string
  avatarUrl?: string
  createdAt: Timestamp
  
  // ê¶Œí•œ ì •ë³´
  role: 'user' | 'verified' | 'moderator' | 'super_admin'
  isVerified: boolean
  verifiedAt?: Timestamp
  verificationData?: {
    businessNumber: string
    representativeName: string
    openingDate: string
    businessType?: string
  }
  
  // ê´€ë¦¬ì ì •ë³´
  isAdmin?: boolean
  adminLevel?: 'super' | 'moderator'
  adminSince?: Timestamp
  permissions?: {
    canDeletePosts: boolean
    canBanUsers: boolean
    canManageSettings: boolean
    canManageReports: boolean
    canManageComments: boolean
    // í™•ì¥ ê°€ëŠ¥
    canManageUsers?: boolean
    canViewAnalytics?: boolean
  }
  
  // ì œì¬ ì •ë³´
  isBanned: boolean
  banReason?: string
  banUntil?: Timestamp
  warnings: number
  warningHistory?: Array<{
    reason: string
    issuedAt: Timestamp
    issuedBy: string
  }>
  
  // í™œë™ ì •ë³´
  postCount: number
  commentCount: number
  likeCount: number
  reputation: number // ì‹ ë¢°ë„ ì ìˆ˜
  
  // ì»¤ìŠ¤í…€ ê¶Œí•œ (ê°œë³„ ë¶€ì—¬)
  customPermissions?: string[]
  
  // ë©”íƒ€ë°ì´í„°
  lastActiveAt: Timestamp
  region?: string
  businessType?: string
}
```

## ğŸ›¡ï¸ ê¶Œí•œ ì²´í¬ ë¯¸ë“¤ì›¨ì–´/í›…

### React Hook ì˜ˆì‹œ

```typescript
// hooks/usePermissions.ts
import { useState, useEffect } from 'react'
import { auth, db } from '@/lib/firebase'
import { onAuthStateChanged } from 'firebase/auth'
import { doc, getDoc } from 'firebase/firestore'
import { UserPermissions, Permission, hasPermission } from '@/lib/permissions'

export function usePermissions() {
  const [userPerms, setUserPerms] = useState<UserPermissions | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    if (!auth || !db) {
      setLoading(false)
      return
    }

    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      if (!user) {
        setUserPerms(null)
        setLoading(false)
        return
      }

      try {
        const userRef = doc(db, 'users', user.uid)
        const userSnap = await getDoc(userRef)
        
        if (userSnap.exists()) {
          const data = userSnap.data()
          const perms: UserPermissions = {
            uid: user.uid,
            role: data.role || 'user',
            isVerified: data.isVerified || false,
            isBanned: data.isBanned || false,
            banUntil: data.banUntil?.toDate(),
            warnings: data.warnings || 0,
            permissions: getPermissionsForRole(data.role, data.customPermissions),
            customPermissions: data.customPermissions,
          }
          setUserPerms(perms)
        }
      } catch (error) {
        console.error('ê¶Œí•œ ë¡œë“œ ì˜¤ë¥˜:', error)
      } finally {
        setLoading(false)
      }
    })

    return () => unsubscribe()
  }, [])

  const can = (permission: Permission): boolean => {
    if (!userPerms || userPerms.isBanned) return false
    return hasPermission(userPerms.role, permission) ||
           userPerms.customPermissions?.includes(permission) ||
           false
  }

  return { userPerms, loading, can }
}
```

## ğŸ¯ ê¸°ëŠ¥ë³„ ê¶Œí•œ ì ìš© ì˜ˆì‹œ

### 1. ê²Œì‹œê¸€ ì‘ì„± ì œí•œ

```typescript
// components/WriteModal.tsx
import { usePermissions } from '@/hooks/usePermissions'
import { Permission } from '@/lib/permissions'

export default function WriteModal() {
  const { can, userPerms } = usePermissions()
  
  const maxPostsPerDay = can(Permission.PREMIUM_FEATURES) ? 10 : 3
  
  // ì¼ì¼ ê²Œì‹œê¸€ ì œí•œ ì²´í¬
  const canPost = checkDailyPostLimit(userPerms?.uid, maxPostsPerDay)
  
  if (!canPost) {
    return <Alert>ì˜¤ëŠ˜ ê²Œì‹œê¸€ ì‘ì„± í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.</Alert>
  }
  
  // ...
}
```

### 2. ì¸ì¦ ë°°ì§€ í‘œì‹œ

```typescript
// components/PostAuthorBadge.tsx
import { usePermissions } from '@/hooks/usePermissions'

export default function PostAuthorBadge({ userId }: { userId: string }) {
  const { userPerms } = usePermissions()
  
  if (userPerms?.isVerified) {
    return (
      <span className="badge verified">
        âœ… ì¸ì¦ëœ ìì˜ì—…ì
      </span>
    )
  }
  
  return null
}
```

### 3. ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥

```typescript
// app/admin/posts/page.tsx
import { usePermissions } from '@/hooks/usePermissions'
import { Permission } from '@/lib/permissions'

export default function PostsPage() {
  const { can, userPerms } = usePermissions()
  
  if (!can(Permission.POST_DELETE_ANY)) {
    return <div>ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>
  }
  
  // ê´€ë¦¬ì ê¸°ëŠ¥ í‘œì‹œ
  return (
    <div>
      <button onClick={handleDelete}>ì‚­ì œ</button>
      {can(Permission.USER_BAN_PERM) && (
        <button onClick={handleBan}>ì˜êµ¬ ì •ì§€</button>
      )}
    </div>
  )
}
```

## ğŸ”„ ê¶Œí•œ ì—…ê·¸ë ˆì´ë“œ í”„ë¡œì„¸ìŠ¤

### 1. ì¼ë°˜ ì‚¬ìš©ì â†’ ì¸ì¦ëœ ìì˜ì—…ì

```
ì‚¬ìš©ì ì¸ì¦ ì‹ ì²­
  â†“
êµ­ì„¸ì²­ API ê²€ì¦ (1ì°¨)
  â†“
GPT-4 Vision ì´ë¯¸ì§€ ê²€ì¦ (2ì°¨)
  â†“
ê´€ë¦¬ì ìŠ¹ì¸ (ì„ íƒì , ìë™ ìŠ¹ì¸ ê°€ëŠ¥)
  â†“
ê¶Œí•œ ì—…ê·¸ë ˆì´ë“œ
  â†“
ì¸ì¦ ë°°ì§€ ë¶€ì—¬
```

### 2. ì¸ì¦ëœ ìì˜ì—…ì â†’ ëª¨ë”ë ˆì´í„°

```
ê´€ë¦¬ì ì¶”ì²œ ë˜ëŠ” ì‹ ì²­
  â†“
í™œë™ ë‚´ì—­ ê²€í† 
  â†“
ìŠˆí¼ ê´€ë¦¬ì ìŠ¹ì¸
  â†“
ëª¨ë”ë ˆì´í„° ê¶Œí•œ ë¶€ì—¬
  â†“
êµìœ¡ ë° ê°€ì´ë“œë¼ì¸ ì œê³µ
```

## ğŸ“ˆ ì‹ ë¢°ë„ ì ìˆ˜ ì‹œìŠ¤í…œ (Reputation)

```typescript
interface ReputationSystem {
  // ì ìˆ˜ íšë“
  postCreated: +1
  postLiked: +0.1 (ë°›ì€ ì¢‹ì•„ìš”)
  commentHelpful: +0.5
  verifiedBusiness: +10 (ì¸ì¦ ì‹œ)
  
  // ì ìˆ˜ ê°ì†Œ
  postDeleted: -5
  commentDeleted: -2
  warningReceived: -10
  banReceived: -50
  
  // ë ˆë²¨ ì‹œìŠ¤í…œ
  levels: {
    0-10: 'ìƒˆë‚´ê¸°'
    11-50: 'í™œë™ê°€'
    51-100: 'ë² í…Œë‘'
    101-200: 'ì „ë¬¸ê°€'
    201+: 'ë§ˆìŠ¤í„°'
  }
  
  // ë ˆë²¨ë³„ í˜œíƒ
  benefits: {
    'ì „ë¬¸ê°€': 'ê´‘ê³  ì œê±°, í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥'
    'ë§ˆìŠ¤í„°': 'ëª¨ë”ë ˆì´í„° ì¶”ì²œ ìê²©'
  }
}
```

## ğŸš« ì œì¬ ì‹œìŠ¤í…œ

### ê²½ê³  (Warning)
- 1ì°¨: ê²½ê³ ë§Œ
- 2ì°¨: 1ì¼ ì •ì§€
- 3ì°¨: 3ì¼ ì •ì§€
- 4ì°¨: 7ì¼ ì •ì§€
- 5ì°¨: 30ì¼ ì •ì§€ ë˜ëŠ” ì˜êµ¬ ì •ì§€ ê²€í† 

### ì •ì§€ (Ban)
- **ì¼ì‹œ ì •ì§€**: ëª¨ë”ë ˆì´í„° ê¶Œí•œ
  - 1ì¼, 3ì¼, 7ì¼, 30ì¼
- **ì˜êµ¬ ì •ì§€**: ìŠˆí¼ ê´€ë¦¬ìë§Œ ê°€ëŠ¥

### ì •ì§€ ì‚¬ìœ  ì¹´í…Œê³ ë¦¬
- ìŠ¤íŒ¸/ê´‘ê³ 
- ìš•ì„¤/í˜ì˜¤ í‘œí˜„
- ê°œì¸ì •ë³´ ë…¸ì¶œ
- í—ˆìœ„ ì •ë³´
- ê¸°íƒ€ ê·œì¹™ ìœ„ë°˜

## ğŸ” ê°ì‚¬ ë¡œê·¸ (Audit Log)

```typescript
interface AuditLog {
  id: string
  action: 'delete_post' | 'ban_user' | 'warn_user' | 'grant_permission'
  targetUserId: string
  targetPostId?: string
  performedBy: string
  performedAt: Timestamp
  reason?: string
  details: Record<string, any>
}
```

ëª¨ë“  ê´€ë¦¬ì í–‰ë™ì„ ê¸°ë¡í•˜ì—¬ íˆ¬ëª…ì„± í™•ë³´

## ğŸ’¡ ì¶”ê°€ ì•„ì´ë””ì–´

### 1. ì—­í•  ê¸°ë°˜ UI í‘œì‹œ
- ì¸ì¦ëœ ì‚¬ìš©ì: í”„ë¦¬ë¯¸ì—„ ë°°ë„ˆ, ê´‘ê³  ì—†ìŒ
- ê´€ë¦¬ì: ê´€ë¦¬ì ë©”ë‰´, í†µê³„ ëŒ€ì‹œë³´ë“œ

### 2. ë™ì  ê¶Œí•œ
- ì´ë²¤íŠ¸ ê¸°ê°„ íŠ¹ë³„ ê¶Œí•œ
- ì§€ì—­ë³„ ëª¨ë”ë ˆì´í„°
- ì¹´í…Œê³ ë¦¬ë³„ ê´€ë¦¬ì

### 3. ê¶Œí•œ ìœ„ì„
- ìŠˆí¼ ê´€ë¦¬ìê°€ íŠ¹ì • ê¶Œí•œë§Œ ìœ„ì„
- ì„ì‹œ ê´€ë¦¬ì (ê¸°ê°„ ì œí•œ)

### 4. ê¶Œí•œ ìš”ì²­ ì‹œìŠ¤í…œ
- ì‚¬ìš©ìê°€ íŠ¹ì • ê¶Œí•œ ìš”ì²­
- ê´€ë¦¬ì ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤

## ğŸ“ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1 (í•„ìˆ˜)
1. âœ… ê¸°ë³¸ ì—­í•  ì‹œìŠ¤í…œ (user, verified, moderator, super_admin)
2. âœ… ê¶Œí•œ ì²´í¬ í•¨ìˆ˜
3. âœ… ì¸ì¦ ë°°ì§€ í‘œì‹œ
4. âœ… ê´€ë¦¬ì ê¶Œí•œ ì²´í¬

### Phase 2 (ì¤‘ìš”)
5. â³ ì¼ì¼ ê²Œì‹œê¸€ ì œí•œ
6. â³ ì œì¬ ì‹œìŠ¤í…œ (ê²½ê³ , ì •ì§€)
7. â³ ê¶Œí•œ ê¸°ë°˜ UI í‘œì‹œ
8. â³ ê°ì‚¬ ë¡œê·¸

### Phase 3 (ì„ íƒ)
9. â³ ì‹ ë¢°ë„ ì ìˆ˜ ì‹œìŠ¤í…œ
10. â³ ë™ì  ê¶Œí•œ
11. â³ ê¶Œí•œ ìš”ì²­ ì‹œìŠ¤í…œ

