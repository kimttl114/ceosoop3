# 🔍 Vercel 서버리스 환경 분석

## 📊 로컬 vs Vercel 차이점

### 로컬 환경
- ✅ 전체 파일 시스템 접근 가능
- ✅ 임시 파일 시스템 (`tmpdir()`) 사용 가능
- ✅ FFmpeg/FFprobe 바이너리 직접 실행 가능
- ✅ 실행 시간 제한 없음
- ✅ 충분한 메모리/CPU

### Vercel 서버리스 환경 (Lambda)
- ❌ 읽기 전용 파일 시스템 (`/tmp`만 쓰기 가능)
- ❌ 바이너리 파일 실행 제한
- ❌ 실행 시간 제한 (기본 10초, 최대 60초)
- ❌ 메모리 제한 (1GB 기본)
- ❌ CPU 제한

---

## 🔍 예상 문제 원인

### 문제 1: 바이너리 파일 배포 불가

**원인:**
- `ffmpeg-static`과 `ffprobe-static`의 바이너리 파일이 너무 큼 (각각 ~80MB, ~60MB)
- Vercel은 소스 코드만 배포하고 `node_modules`의 큰 바이너리는 배포하지 않을 수 있음

**확인 방법:**
- Vercel 빌드 로그에서 바이너리 파일 크기 확인
- 실행 시 바이너리 파일 경로가 존재하는지 확인

### 문제 2: 실행 권한 문제

**원인:**
- Lambda 환경에서는 바이너리 파일 실행 권한이 없을 수 있음
- chmod 실행 불가

### 문제 3: `/tmp` 디렉토리 제한

**원인:**
- Vercel Lambda는 `/tmp` 디렉토리만 쓰기 가능 (512MB 제한)
- 임시 파일 생성/삭제 제한

### 문제 4: 실행 시간 제한

**원인:**
- 기본 10초 제한
- FFmpeg 처리가 오래 걸릴 수 있음

### 문제 5: 메모리 부족

**원인:**
- 오디오 파일 처리 시 메모리 사용량 증가
- BGM 믹싱 중 메모리 부족 가능

---

## 🔍 확인해야 할 사항

1. **Vercel 함수 설정**
   - `maxDuration` 설정 확인
   - 메모리 설정 확인

2. **바이너리 파일 경로**
   - Vercel 환경에서 실제 경로 확인
   - 파일 존재 여부 확인

3. **에러 로그**
   - Vercel 함수 로그 확인
   - 상세한 에러 메시지 확인

---

**다음 단계**: Vercel 함수 로그와 설정을 확인하여 정확한 원인 파악

